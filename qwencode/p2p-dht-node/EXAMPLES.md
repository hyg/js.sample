# 使用示例

## 1. 配置中转服务器

在`src/config.js`中配置合适的第三方中转服务器：

```javascript
{
  // 中转服务器配置（使用已存在的第三方服务器）
  relayServer: {
    // 服务器URL (在中国大陆可访问的服务器)
    url: 'wss://third-party-relay.example.com',
    // 如果需要认证
    token: null
  }
}
```

## 2. 启动P2P节点

在不同的机器上运行：

```bash
npm start
```

每个节点会：

1. 初始化NAT穿透（如果可用）
2. 启动DHT客户端
3. 启动TCP监听服务器
4. 连接到配置的第三方中转服务器
5. 定期通过DHT查找其他节点

## 3. 观察日志

节点启动后会显示类似以下的日志：

```
NAT客户端初始化成功
DHT节点监听在端口 6881
TCP服务器监听在端口 56789
连接到中转服务器成功
节点启动成功: abc123...
```

## 4. 节点发现和连接

节点会定期通过DHT协议查找其他节点，并尝试建立直接连接。

当发现新节点时会显示：
```
发现新节点: 192.168.1.100:56790
```

当成功连接到节点时会显示：
```
连接到节点 192.168.1.100:56790 成功
```

## 5. 停止节点

按Ctrl+C可以优雅地停止节点，程序会自动清理资源。

## 配置说明

### 修改监听端口

在`src/config.js`中修改：

```javascript
{
  // DHT配置
  dht: {
    port: 6881  // 修改DHT端口
  },
  
  // 节点配置
  node: {
    port: 0  // 0表示随机分配，可以指定固定端口
  }
}
```

### 配置第三方中转服务器

```javascript
{
  // 中转服务器配置（使用已存在的第三方服务器）
  relayServer: {
    // 服务器URL (在中国大陆可访问的服务器)
    url: 'wss://your-relay-server.com',
    // 如果需要认证
    token: 'your-token-here'
  }
}
```

### 在没有NAT的环境中运行

如果在没有UPnP路由器的环境中运行，NAT穿透会自动跳过，节点仍然可以通过中转服务器工作。

### 在DHT网络中没有其他节点

如果DHT网络中没有其他节点，节点发现功能会暂时无法工作，但不会影响程序运行。当有其他节点上线时，会自动发现并连接。

## 中国大陆可用的中转服务器选项

1. **阿里云公共DNS** - 可作为DHT引导节点
2. **腾讯云CDN节点** - 部分支持WebSocket
3. **公共BitTorrent DHT节点** - 如router.bittorrent.com
4. **自建中转服务器** - 在云服务商部署

注意：在生产环境中，请使用稳定可靠的第三方中转服务器。