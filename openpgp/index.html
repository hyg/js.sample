<!DOCTYPE html>
<html>
  <head>
	<script src="multiline.js"></script>
	<!-- or  https://raw.githubusercontent.com/sindresorhus/multiline/master/browser.js -->
	<script src="openpgp.min.js"></script>

	<script>
		var openpgp = window.openpgp;
		var passphrase = prompt('准备创建密钥，请输入密钥口令');
		var publicKey,privateKey;
		var opt = {numBits: 512, userId: '测试账号 (hyg/js.sample) <test@jssample.org>', passphrase: passphrase};
		openpgp.generateKeyPair(opt).then(function(key) {
			document.write("公钥：<br/><pre>"+key.publicKeyArmored+"</pre><br/><br/>");
			document.write("私钥：<br/><pre>"+key.privateKeyArmored+"</pre><br/><br/>");
			
			publicKey = openpgp.key.readArmored(key.publicKeyArmored).keys[0];
			privateKey = openpgp.key.readArmored(key.privateKeyArmored).keys[0];
			
			var plaintext = prompt("准备加密，请输入明文");
			passphrase = prompt("准备解密，请输入密钥口令");
			privateKey.decrypt(passphrase);
			
			openpgp.encryptMessage(publicKey, plaintext).then(function(pgpMessage) {
				// success
				document.write("密文：<br/><pre>"+pgpMessage+"</pre><br/><br/>");
				
				pgpMessage = openpgp.message.readArmored(pgpMessage);
	
				openpgp.decryptMessage(privateKey, pgpMessage).then(function(plaintext) {
					// success
					document.write("明文是：<br/><pre>"+plaintext+"</pre><br/><br/>");
				}).catch(function(error) {
					// failure
					alert("解密失败！");
				});
				
			}).catch(function(error) {
				// failure
				alert("加密失败！");
			});
			
			openpgp.signClearMessage(privateKey,plaintext).then(function(pgpMessage){
				// success
				document.write("签名：<br/><pre>"+pgpMessage+"</pre><br/><br/>");
				
				pgpMessage = openpgp.cleartext.readArmored(pgpMessage);
				
				openpgp.verifyClearSignedMessage(publicKey,pgpMessage).then(function(verifiedmessage){
					// success
					document.write("正文：<br/><pre>"+verifiedmessage.text+"</pre><br/><br/>");
					
					for (var i=0;i<verifiedmessage.signatures.length;i++)
					{
						document.write("第"+i+"个签名人：\tkeyid:"+verifiedmessage.signatures[i].keyid.toHex() +"\tvalid:"+verifiedmessage.signatures[i].valid+"<br/>");
					}
				}).catch(function(error) {
				// failure
				alert("签名验证失败！");
			});
				
			}).catch(function(error) {
				// failure
				alert("签名失败！");
			});
		});
	</script>
  </head>
  <body>
  
  
  </body>
</html>