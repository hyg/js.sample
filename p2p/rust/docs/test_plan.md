# P2P 节点软件测试计划

## 1. 测试目标

本测试计划旨在验证使用 Rust 开发的 P2P 节点软件是否满足以下核心需求：
- 使用 STUN 服务器和 DHT 协议进行节点发现和通信
- 支持 NAT 穿透
- 不依赖中心服务器进行数据传输
- 节点连接建立时可借助第三方服务器（需在中国大陆可用）
- 通信时最小化信息泄露

## 2. 测试环境

### 2.1 硬件环境
- 开发机：Windows 10/11 PC
- 服务器：至少两台云服务器（位于不同地域）
- 网络设备：支持 NAT 的路由器

### 2.2 软件环境
- Rust 1.89 或更高版本
- Cargo 包管理器
- Git 版本控制
- 网络抓包工具（如 Wireshark）

## 3. 测试策略

### 3.1 本地单节点测试
**目标**：验证单个节点的基本功能和启动流程

**步骤**：
1. 在本地机器上启动一个节点实例
2. 观察节点启动过程中的日志输出
3. 检查节点是否能成功监听端口
4. 验证节点是否能连接到 DHT Bootstrap 节点
5. 确认 Kademlia 和 Ping 行为是否正常初始化

**预期结果**：
- 节点能成功启动并监听端口
- 节点能连接到至少部分 Bootstrap 节点
- 日志显示正常的 Bootstrap 和节点发现过程

### 3.2 本地多节点测试
**目标**：验证同一网络内多个节点之间的发现和通信能力

**步骤**：
1. 在本地机器上启动多个节点实例（使用不同端口）
2. 观察节点之间是否能通过 DHT 发现彼此
3. 检查 Ping 行为是否能正常工作
4. 测试节点间的基本通信功能

**预期结果**：
- 节点之间能成功发现彼此
- Ping 延迟在合理范围内
- 节点间能建立稳定的连接

### 3.3 跨网络测试
**目标**：验证节点在不同网络环境下的 NAT 穿透和通信能力

**步骤**：
1. 在不同的网络环境下（不同的局域网或云服务器）运行节点
2. 测试 NAT 穿透功能，观察节点是否能成功建立连接
3. 测量跨网络通信的延迟和稳定性
4. 验证在复杂网络环境下的节点发现成功率

**预期结果**：
- 节点能成功穿透 NAT 并建立连接
- 跨网络通信延迟在可接受范围内
- 节点发现成功率较高

### 3.4 压力测试
**目标**：评估系统在高负载情况下的性能和可扩展性

**步骤**：
1. 模拟大量节点同时加入网络
2. 监控系统资源使用情况（CPU、内存、网络带宽）
3. 测试节点发现和通信的响应时间
4. 观察系统在高负载下的稳定性

**预期结果**：
- 系统能处理大量并发节点
- 资源使用在合理范围内
- 节点发现和通信响应时间可接受

### 3.5 错误处理测试
**目标**：验证系统在异常情况下的健壮性和恢复能力

**步骤**：
1. 模拟网络故障（如断开网络连接）
2. 模拟节点崩溃和重启
3. 测试对无效或恶意数据的处理
4. 验证系统是否能正确处理这些错误并恢复

**预期结果**：
- 系统能正确检测和处理各种错误
- 节点能在故障后恢复正常运行
- 不会因单个节点故障导致整个网络瘫痪

## 4. 测试工具

- 日志分析工具
- 网络监控工具
- 性能监控工具
- 自动化测试脚本

## 5. 测试数据收集

- 启动时间
- 节点发现时间
- 连接建立时间
- Ping 延迟
- CPU 和内存使用率
- 网络带宽使用情况
- 错误日志和异常情况

## 6. 风险评估

- 网络环境复杂性可能导致测试结果不稳定
- 跨网络测试需要多台服务器资源
- 某些 NAT 类型可能无法穿透
- 大规模压力测试可能影响系统稳定性

## 7. 测试进度安排

| 阶段 | 时间 | 任务 |
|------|------|------|
| 准备阶段 | 第1天 | 搭建测试环境，准备测试工具 |
| 单节点测试 | 第2天 | 执行本地单节点测试 |
| 多节点测试 | 第3天 | 执行本地多节点测试 |
| 跨网络测试 | 第4-5天 | 执行跨网络测试 |
| 压力测试 | 第6天 | 执行压力测试 |
| 错误处理测试 | 第7天 | 执行错误处理测试 |
| 总结报告 | 第8天 | 分析测试结果，编写测试报告 |